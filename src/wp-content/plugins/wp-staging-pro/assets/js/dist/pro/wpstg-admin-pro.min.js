!function(){"use strict";function e(e,t,n,s,r,o,a){try{var i=e[o](a),c=i.value}catch(e){return void n(e)}i.done?t(c):Promise.resolve(c).then(s,r)}function t(t){return function(){var n=this,s=arguments;return new Promise((function(r,o){var a=t.apply(n,s);function i(t){e(a,r,o,i,c,"next",t)}function c(t){e(a,r,o,i,c,"throw",t)}i(void 0)}))}}function n(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,s=new Array(t);n<t;n++)s[n]=e[n];return s}function s(e,t){var s;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(s=function(e,t){if(e){if("string"==typeof e)return n(e,t);var s=Object.prototype.toString.call(e).slice(8,-1);return"Object"===s&&e.constructor&&(s=e.constructor.name),"Map"===s||"Set"===s?Array.from(e):"Arguments"===s||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(s)?n(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){s&&(e=s);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(s=e[Symbol.iterator]()).next.bind(s)}function r(e){return document.querySelector(e)}function o(e,t,n,s){!e instanceof Element||e.addEventListener(t,(function(e){e.target.matches(n+", "+n+" *")&&s(e.target.closest(n),e)}),!1)}Element.prototype.closest&&(Element.prototype.matches||(Element.prototype.matches=Element.prototype.msMatchesSelector||Element.prototype.webkitMatchesSelector),Element.prototype.closest=function(e){var t=this;do{if(Element.prototype.matches.call(t,e))return t;t=t.parentElement||t.parentNode}while(null!==t&&1===t.nodeType);return null});var a=function(){function e(e,t,n,s){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t=".wpstg-edit-clone-db-inputs"),void 0===n&&(n=wpstg),void 0===s&&(s="wpstg_database_connect"),this.workflow=r(e),this.dbCheckTriggerClass=t,this.wpstgObject=n,this.databaseCheckAction=s,this.dbCheckTimer=null,this.abortDbCheckController=null,this.dbCheckCallStatus=!1,this.notyf=new Notyf({duration:1e4,position:{x:"center",y:"bottom"},dismissible:!0,types:[{type:"warning",background:"orange",icon:!1}]}),this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;null!==this.workflow&&["paste","input"].forEach((function(t){o(e.workflow,t,e.dbCheckTriggerClass,(function(){!0===e.dbCheckCallStatus&&(e.abortDbCheckController.abort(),e.abortDbCheckController=null,e.dbCheckCallStatus=!1),clearTimeout(e.dbCheckTimer),e.dbCheckTimer=setTimeout((function(){e.checkDatabase()}),300)}))}))},t.init=function(){this.addEvents()},t.checkDatabase=function(){var e=this,t="#wpstg-edit-clone-data-",n=r(t+"database-user").value,s=r(t+"database-password").value,o=r(t+"database-database").value,a=r(t+"database-server").value,i=r(t+"database-prefix").value;""!==n||""!==s||""!==o||""!==i?(this.abortDbCheckController=new AbortController,this.dbCheckCallStatus=!0,fetch(this.wpstgObject.ajaxUrl,{method:"POST",signal:this.abortDbCheckController.signal,credentials:"same-origin",body:new URLSearchParams({action:this.databaseCheckAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,databaseUser:n,databasePassword:s,databaseServer:a,databaseDatabase:o,databasePrefix:i,databaseEnsurePrefixTableExist:!0}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(t){return e.dbCheckCallStatus=!1,t.ok?t.json():Promise.reject(t)})).then((function(t){return e.notyf.dismissAll(),!1===t?(e.notyf.error(e.wpstgObject.i18n.dbConnectionFailed),void(r("#wpstg-save-clone-data").disabled=!0)):void 0!==t.errors&&t.errors&&void 0!==t.success&&"false"===t.success?(e.notyf.error(e.wpstgObject.i18n.dbConnectionFailed+"! <br/> Error: "+t.errors),void(r("#wpstg-save-clone-data").disabled=!0)):void 0!==t.errors&&t.errors&&void 0!==t.success&&"true"===t.success?(e.notyf.open({type:"warning",message:"Warning: "+t.errors}),void(r("#wpstg-save-clone-data").disabled=!0)):void(void 0!==t.success&&t.success&&(e.notyf.success(e.wpstgObject.i18n.dbConnectionSuccess),r("#wpstg-save-clone-data").disabled=!1))})).catch((function(t){e.dbCheckCallStatus=!1,console.warn(e.wpstgObject.i18n.somethingWentWrong,t),r("#wpstg-save-clone-data").disabled=!0}))):r("#wpstg-save-clone-data").disabled=!1},e}(),i=function(){function e(e,t,n){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg_select_tables_pushing"),void 0===n&&(n=wpstg),this.workflow=r(e),this.inputSelector=t,this.input=r(t),this.wpstgObject=n,this.cloneID=this.input.getAttribute("data-clone"),this.tablePrefix=this.input.getAttribute("data-prefix"),this.isNetwork="true"===this.input.getAttribute("data-network"),this.areAllTablesChecked=!0,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;o(document.body,"click",".wpstg-button-show-tables",(function(t){e.showAllTables()})),o(document.body,"click",".wpstg-button-db-prefix",(function(){e.selectDefaultTables()})),o(document.body,"click",".wpstg-button-unselect",(function(){e.toggleTableSelection()})),o(document.body,"change",this.inputSelector,(function(){e.countSelectedTables()}))},t.init=function(){this.addEvents()},t.showAllTables=function(){var e=this,t=this.getIncludedTables(),n=this.getExcludedTables();t.length>n.length?t="":n.length>t.length&&(n=""),fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:"wpstg_push_tables",accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,clone:this.cloneID,includedTables:t,excludedTables:n,selectedTablesWithoutPrefix:this.getSelectedTablesWithoutPrefix()}),headers:{"Content-Type":"application/x-www-form-urlencoded"}}).then((function(e){return e.ok?e.json():Promise.reject(e)})).then((function(t){if(void 0!==t.success&&t.success)return e.input.innerHTML=t.content,n=r(".wpstg-button-show-tables"),void 0===(s=300)&&(s=300),n.style.opacity=1,n.style.transitionProperty="opacity",n.style.transitionDuration=s+"ms",setTimeout((function(){n.style.opacity=0,window.setTimeout((function(){n.style.display="none",n.style.removeProperty("opacity"),n.style.removeProperty("transition-duration"),n.style.removeProperty("transition-property")}),s)}),0),void e.countSelectedTables();var n,s;void 0===t.message?e.notyf.error(e.wpstgObject.i18n.somethingWentWrong):e.notyf.error(t.message)})).catch((function(t){console.warn(e.wpstgObject.i18n.somethingWentWrong,t)}))},t.getRegexPattern=function(){var e="^"+this.tablePrefix;return"1"!==this.wpstgObject.isMultisite||this.isNetwork||(e+="([^0-9])_*"),e},t.selectDefaultTables=function(){var e=this.input.querySelectorAll(".wpstg-db-table"),t=this.getRegexPattern();e.forEach((function(e){e.getAttribute("name","").match(t)?e.selected=!0:e.selected=!1})),this.countSelectedTables()},t.toggleTableSelection=function(){!1===this.areAllTablesChecked?(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!0})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Unselect All",this.areAllTablesChecked=!0):(this.input.querySelectorAll(".wpstg-db-table").forEach((function(e){e.selected=!1})),this.workflow.querySelector(".wpstg-button-unselect").innerHTML="Select All",this.areAllTablesChecked=!1),this.countSelectedTables()},t.getSelectedTablesWithoutPrefix=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var s=n.getAttribute("name","");s.match(t)||e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getIncludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:checked").forEach((function(n){var s=n.getAttribute("name","");s.match(t)&&e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.getExcludedTables=function(){var e=[],t=this.getRegexPattern();return this.input.querySelectorAll("option:not(:checked)").forEach((function(n){var s=n.getAttribute("name","");s.match(t)&&e.push(s)})),e.join(this.wpstgObject.settings.directorySeparator)},t.countSelectedTables=function(){var e=this.input.querySelectorAll("option:checked").length,t=r("#wpstg-tables-count");0===e?(t.classList.add("danger"),t.innerHTML=this.wpstgObject.i18n.noTableSelected):(t.classList.remove("danger"),t.innerHTML=this.wpstgObject.i18n.tablesSelected.replace("{d}",e))},e}(),c=function(){function e(e,t,n,s){void 0===e&&(e="#wpstg-workflow"),void 0===t&&(t="#wpstg-scanning-files"),void 0===n&&(n=".wpstg-check-dir"),void 0===s&&(s=wpstg),this.workflow=r(e),this.filesTabSelector=t,this.filesTab=r(t),this.dirSelector=n,this.wpstgObject=s,this.init()}var t=e.prototype;return t.addEvents=function(){var e=this;o(this.workflow,"change",this.filesTabSelector+" "+this.dirSelector,(function(t){e.toggleChildren(t),e.countSelectedFiles()}))},t.init=function(){this.addEvents()},t.toggleChildren=function(e){(function(e,t){for(var n=[],s=e&&e.parentElement;s;s=s.parentElement)s.matches(t)&&n.push(s);return n})(e,".wpstg-dir")[0].querySelectorAll(".wpstg-subdir>.wpstg-dir>"+this.dirSelector).forEach((function(t){t.checked=e.checked}))},t.countSelectedFiles=function(){var e=this,t=this.filesTab.querySelectorAll(this.dirSelector+":checked").length,n=r("#wpstg-files-count");if(0===t)n.classList.add("danger"),n.innerHTML=this.wpstgObject.i18n.noFileSelected;else{var s=0,o=0;n.classList.remove("danger"),this.filesTab.querySelectorAll(".wpstg-dir:not(.wpstg-sub-dir)>.wpstg-expand-dirs").forEach((function(t){"plugins"===t.innerHTML&&(o=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length),"themes"===t.innerHTML&&(s=t.nextSibling.querySelectorAll(e.dirSelector+":checked").length)})),n.innerHTML=this.wpstgObject.i18n.filesSelected.replace("{t}",s).replace("{p}",o)}},e}(),l=function(){function e(e,t,n,s,o,a,i,c,l,g,u,p,d){void 0===e&&(e="#wpstg-btn-provider-revoke"),void 0===t&&(t="#wpstg-provider-revoke-form"),void 0===n&&(n="wpstg-provider-revoke"),void 0===s&&(s="#wpstg-btn-save-provider-settings"),void 0===o&&(o="#wpstg-provider-settings-form"),void 0===a&&(a="wpstg-provider-settings"),void 0===i&&(i="#wpstg-btn-provider-authenticate"),void 0===c&&(c="#wpstg-provider-authenticate-form"),void 0===l&&(l="wpstg-provider-authenticate"),void 0===g&&(g="#wpstg-btn-provider-test-connection"),void 0===u&&(u="#wpstg-provider-test-connection-fields"),void 0===p&&(p="wpstg-provider-test-connection"),void 0===d&&(d=wpstg),this.revokeButtonSelector=e,this.revokeForm=r(t),this.revokeAction=n,this.settingsButtonSelector=s,this.settingsForm=r(o),this.settingsAction=a,this.authenticateButtonSelector=i,this.authenticateForm=r(c),this.authenticateAction=l,this.testConnectionButtonSelector=g,this.testConnectionFields=r(u),this.testConnectionAction=p,this.wpstgObject=d,this.notyf=new Notyf({duration:2e3,position:{x:"center",y:"bottom"},dismissible:!0}),this.init()}var n=e.prototype;return n.addEvents=function(){var e=this;o(document.body,"click",this.revokeButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendRevokeRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),o(document.body,"click",this.settingsButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendSettingsRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),o(document.body,"click",this.authenticateButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendAuthenticateRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),o(document.body,"click",this.testConnectionButtonSelector,function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.sendTestConnectionRequest();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}()),o(document.body,"change","[name='ftp_type']",function(){var n=t(regeneratorRuntime.mark((function t(n){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.toggleSftpFields();case 2:case"end":return t.stop()}}),t)})));return function(e){return n.apply(this,arguments)}}())},n.init=function(){this.addEvents()},n.sendRevokeRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,s;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.revokeForm.querySelector('input[name="provider"]').value,e.prev=1,e.next=4,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:new URLSearchParams({action:this.revokeAction,accessToken:this.wpstgObject.accessToken,nonce:this.wpstgObject.nonce,provider:t}),headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 4:return(n=e.sent).ok||console.error("An error has occured: "+n.status),e.next=8,n.json();case 8:if(!(s=e.sent).success){e.next=13;break}return this.notyf.success(s.message),setTimeout((function(){window.location.reload()}),3e3),e.abrupt("return");case 13:this.notyf.error(s.message),e.next=19;break;case 16:e.prev=16,e.t0=e.catch(1),console.warn(e.t0);case 19:case"end":return e.stop()}}),e,this,[[1,16]])})));return function(){return e.apply(this,arguments)}}(),n.sendSettingsRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,s,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData(this.settingsForm)).append("action",this.settingsAction),t.append("accessToken",this.wpstgObject.accessToken),t.append("nonce",this.wpstgObject.nonce),n=new URLSearchParams(t),e.prev=5,e.next=8,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return(s=e.sent).ok||console.error("An error has occured: "+s.status),e.next=12,s.json();case 12:if(!(r=e.sent).success){e.next=17;break}return this.notyf.success(r.message),setTimeout((function(){window.location.reload()}),2e3),e.abrupt("return");case 17:this.notyf.error(r.message),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn(e.t0);case 23:case"end":return e.stop()}}),e,this,[[5,20]])})));return function(){return e.apply(this,arguments)}}(),n.sendAuthenticateRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,s,r;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return(t=new FormData(this.authenticateForm)).append("action",this.authenticateAction),t.append("accessToken",this.wpstgObject.accessToken),t.append("nonce",this.wpstgObject.nonce),n=new URLSearchParams(t),e.prev=5,e.next=8,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:n,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 8:return(s=e.sent).ok||console.error("An error has occured: "+s.status),e.next=12,s.json();case 12:if(!(r=e.sent).success){e.next=17;break}return this.notyf.success(r.message),setTimeout((function(){window.location.reload()}),2e3),e.abrupt("return");case 17:this.notyf.error(r.message),e.next=23;break;case 20:e.prev=20,e.t0=e.catch(5),console.warn(e.t0);case 23:case"end":return e.stop()}}),e,this,[[5,20]])})));return function(){return e.apply(this,arguments)}}(),n.sendTestConnectionRequest=function(){var e=t(regeneratorRuntime.mark((function e(){var t,n,s,r,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.testConnectionFields.querySelectorAll("[name]"),(n=new FormData).append("action",this.testConnectionAction),n.append("accessToken",this.wpstgObject.accessToken),n.append("nonce",this.wpstgObject.nonce),t.forEach((function(e){n.append(e.getAttribute("name"),e.value)})),s=new URLSearchParams(n),e.prev=7,e.next=10,fetch(this.wpstgObject.ajaxUrl,{method:"POST",credentials:"same-origin",body:s,headers:{"Content-Type":"application/x-www-form-urlencoded"}});case 10:return(r=e.sent).ok||console.error("An error has occured: "+r.status),e.next=14,r.json();case 14:if(!(o=e.sent).success){e.next=18;break}return this.notyf.success(o.message),e.abrupt("return");case 18:this.notyf.error(o.message),e.next=24;break;case 21:e.prev=21,e.t0=e.catch(7),console.warn(e.t0);case 24:case"end":return e.stop()}}),e,this,[[7,21]])})));return function(){return e.apply(this,arguments)}}(),n.toggleSftpFields=function(){var e=document.querySelector("[name='ftp_type']"),t=document.querySelectorAll(".only-sftp"),n=document.querySelectorAll(".only-ftp");if("ftp"!==e.value){if(t.length)for(var r,o=s(t);!(r=o()).done;){r.value.classList.remove("hidden")}if(n.length)for(var a,i=s(n);!(a=i()).done;){a.value.classList.add("hidden")}}else{if(t.length)for(var c,l=s(t);!(c=l()).done;){c.value.classList.add("hidden")}if(n.length)for(var g,u=s(n);!(g=u()).done;){g.value.classList.remove("hidden")}}},e}();function g(e,t,n,s){var r,o,a,i,c=!1,l=!1,g={},u=0,p=0,d={sensitivity:7,interval:100,timeout:0,handleFocus:!1};function h(e){r=e.clientX,o=e.clientY}function w(e,t){if(p&&(p=clearTimeout(p)),Math.abs(a-r)+Math.abs(i-o)<d.sensitivity)return u=1,l?void 0:n(e,t);a=r,i=o,p=setTimeout((function(){w(e,t)}),d.interval)}function f(e,t){return c=!0,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",h,!1),1!==u&&(a=t.clientX,i=t.clientY,e.addEventListener("mousemove",h,!1),p=setTimeout((function(){w(e,t)}),d.interval)),this}function b(e){e.target.matches(t+", "+t+" *")&&f(e.target.closest(t),e)}function m(e,t){return c=!1,p&&(p=clearTimeout(p)),e.removeEventListener("mousemove",h,!1),1===u&&(p=setTimeout((function(){!function(e,t){p&&(p=clearTimeout(p)),u=0,l||s(e,t)}(e,t)}),d.timeout)),this}function v(e){e.target.matches(t+", "+t+" *")&&m(e.target.closest(t),e)}function y(e){var s,r;e.target.matches(t+", "+t+" *")&&(s=e.target.closest(t),r=e,c||(l=!0,n(s,r)))}function S(e){var n,r;e.target.matches(t+", "+t+" *")&&(n=e.target.closest(t),r=e,!c&&l&&(l=!1,s(n,r)))}function k(){e.removeEventListener("focus",y,!1),e.removeEventListener("blur",S,!1)}return g.options=function(t){var n=t.handleFocus!==d.handleFocus;return d=Object.assign({},d,t),n&&(d.handleFocus?(e.addEventListener("focus",y,!1),e.addEventListener("blur",S,!1)):k()),g},g.remove=function(){e&&(e.removeEventListener("mouseover",b,!1),e.removeEventListener("mouseout",v,!1),k())},e&&(e.addEventListener("mouseover",b,!1),e.addEventListener("mouseout",v,!1)),g}var u,p,d,h,w,f,b,m,v,y,S,k,x,T=function(e){var t={continueErrorHandle:!0,cache:{elements:[],get:function(t){return-1!==e.inArray(t,this.elements)||(this.elements[t]=e(t)),this.elements[t]},refresh:function(t){t.elements[t]=e(t)}},setJobId:function(e){localStorage.setItem("jobIdBeingProcessed",e)},getJobId:function(){return localStorage.getItem("jobIdBeingProcessed")},listenTooltip:function(){g(document,".wpstg--tooltip",(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="visible"}),(function(e,t){e.querySelector(".wpstg--tooltiptext").style.visibility="hidden"}))},isEmpty:function(e){for(var t in e)if(e.hasOwnProperty(t))return!1;return!0},getSwalModal:function(e,t){void 0===e&&(e=!1),void 0===t&&(t={});var n={confirmButton:"wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn wpstg-100-width",cancelButton:"wpstg--btn--cancel wpstg-blue-primary wpstg-link-btn wpstg-100-width",actions:"wpstg--modal--actions",popup:e?"wpstg-swal-popup centered-modal":"wpstg-swal-popup"},s={customClass:Object.assign(n,t),buttonsStyling:!1,reverseButtons:!0,showClass:{popup:"wpstg--swal2-show wpstg-swal-show"}};return wpstgSwal.mixin(s)},showSuccessModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"success",title:"Success!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showWarningModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"warning",title:"",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},showErrorModal:function(e){this.getSwalModal().fire({showConfirmButton:!1,showCancelButton:!0,cancelButtonText:"OK",icon:"error",title:"Error!",html:'<div class="wpstg--grey" style="text-align: left; margin-top: 8px;">'+e+"</div>"})},getSwalContainer:function(){return wpstgSwal.getContainer()},closeSwalModal:function(){wpstgSwal.close()},getDataFromWordPressResponse:function(e){if("object"!=typeof e)throw new Error("Unexpected response (ERR 1341)");if(!e.hasOwnProperty("success"))throw new Error("Unexpected response (ERR 1342)");if(!e.hasOwnProperty("data"))throw new Error("Unexpected response (ERR 1343)");if(!1===e.success)throw e.data instanceof Array&&e.data.length>0?new Error(e.data.shift()):new Error("Response was not successful");return e.data},isLoading:function(e){e&&!1!==e?t.cache.get(".wpstg-loader").show():t.cache.get(".wpstg-loader").hide()},slugify:function(e){return e.toString().toLowerCase().normalize("NFD").replace(/[\u0300-\u036f]/g,"").replace(/\s+/g,"-").replace(/&/g,"-and-").replace(/[^a-z0-9\-]/g,"").replace(/-+/g,"-").replace(/^-*/,"").replace(/-*$/,"")},showAjaxFatalError:function(e,n,s){return n=n?n+"<br/><br/>":"Something went wrong! <br/><br/>",s=s?s+"<br/><br/>":"<br/><br/>Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.",!1===e?(t.showError(n+" Error: No response."+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==e.error&&e.error?(t.showError(n+" Error: "+e.message+s),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0},handleFetchErrors:function(e){return e.ok||t.showError("Error: "+e.status+" - "+e.statusText+". Please try again or contact support."),e},showError:function(n){t.cache.get("#wpstg-try-again").css("display","inline-block"),t.cache.get("#wpstg-cancel-cloning").text("Reset"),t.cache.get("#wpstg-resume-cloning").show(),t.cache.get("#wpstg-error-wrapper").show(),t.cache.get("#wpstg-error-details").show().html(n),t.cache.get("#wpstg-removing-clone").removeClass("loading"),t.cache.get(".wpstg-loader").hide(),e(".wpstg--modal--process--generic-problem").show().html(n)},resetErrors:function(){t.cache.get("#wpstg-error-details").hide().html("")},ajax:function(n,s,r,o,a,i,c){void 0===i&&(i=null),void 0===c&&(c=null),void 0===r&&(r="json"),!1!==o&&(o=!0);var l=10,g=1e4*(a=void 0===a?0:a);i=parseInt(i),isNaN(i)||(g*=i),e.ajax({url:ajaxurl+"?action=wpstg_processing&_="+Date.now()/1e3,type:"POST",dataType:r,cache:!1,data:n,error:function(e,u,p){if(console.log(e.status+" "+e.statusText+"---"+u),"function"!=typeof c||(c(e,u,p),t.continueErrorHandle))if(++a<=l)setTimeout((function(){t.ajax(n,s,r,o,a,i)}),g);else{var d=void 0===e.status?"Unknown":e.status;t.showError("Fatal Error:  "+d+" Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")}else t.continueErrorHandle=!0},success:function(e){"function"==typeof s&&s(e)},statusCode:{404:function(){a>=l&&t.showError("Error 404 - Can't find ajax request URL! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},500:function(){a>=l&&t.showError("Fatal Error 500 - Internal server error while processing the request! Please try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.")},504:function(){a>l&&t.showError("Error 504 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},502:function(){a>=l&&t.showError("Error 502 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},503:function(){a>=l&&t.showError("Error 503 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},429:function(){a>=l&&t.showError("Error 429 - It looks like your server is rate limiting ajax requests. Please try to resume after a minute. If this still not works try the <a href='https://wp-staging.com/docs/wp-staging-settings-for-small-servers/' target='_blank'>WP Staging Small Server Settings</a> or submit an error report and contact us.\n ")},403:function(){a>=l&&t.showError("Refresh page or login again! The process should be finished successfully. \n ")}}})}};return t}(jQuery),P=(u=jQuery,d={elements:[],get:function(e){return-1!==u.inArray(e,d.elements)||(d.elements[e]=jQuery(e)),d.elements[e]},refresh:function(e){e.elements[e]=jQuery(e)}},h=function e(){d.get(".wpstg-loader").show(),d.get(".wpstg-log-details").show();var t=d.get("#wpstg-push-changes").data("clone"),n=d.get("#wpstg-delete-upload-before-pushing")[0].checked,s=!1;n&&(s=d.get("#wpstg-backup-upload-before-pushing")[0].checked);var r=f(),o=b(),a=!1;r.length>o.length?r="":o.length>r.length&&(o="",a=""===r),WPStaging.ajax({action:"wpstg_push_processing",accessToken:wpstg.accessToken,nonce:wpstg.nonce,clone:t,includedTables:r,excludedTables:o,allTablesExcluded:a,selectedTablesWithoutPrefix:m(),includedDirectories:y(),excludedDirectories:S(),extraDirectories:k(),createBackupBeforePushing:d.get("#wpstg-create-backup-before-pushing")[0].checked,deletePluginsAndThemes:d.get("#wpstg-remove-uninstalled-plugins-themes")[0].checked,deleteUploadsBeforePushing:n,backupUploadsBeforePushing:s},(function(t){return!1===t?(showError("Something went wrong! Error: No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),d.get(".wpstg-loader").hide(),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):void 0!==t.error&&t.error?(WPStaging.showError("Something went wrong! Error: "+t.message+".  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),void window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess)):(void 0!==t.last_msg&&t.last_msg&&WPStaging.getLogs(t.last_msg),void(!1===t.status?(x(t),setTimeout((function(){d.get(".wpstg-loader").show(),e()}),wpstg.delayReq)):!0===t.status?(x(t),e()):("finished"===t.status||void 0!==t.job_done&&t.job_done)&&(window.removeEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),w(t))))}),"json",!1)},w=function(e){x(e),d.get(".wpstg-loader").text("Finished"),d.get(".wpstg-loader").addClass("wpstg-finished"),d.get(".wpstg-prev-step-link").attr("disabled",!1),T.getSwalModal(!0,{confirmButton:"wpstg--btn--confirm wpstg-green-button wpstg-button wpstg-link-btn wpstg-100-width",popup:"wpstg-swal-popup wpstg-push-finished centered-modal"}).fire({title:"Push successful!",icon:"success",html:"Delete site cache if required!",width:"500px",focusConfirm:!0})},f=function(){return null===p.tableSelector?"":p.tableSelector.getIncludedTables()},b=function(){return null===p.tableSelector?"":p.tableSelector.getExcludedTables()},m=function(){return null===p.tableSelector?"":p.tableSelector.getSelectedTablesWithoutPrefix()},v=function(e,t,n,s){return T.getSwalModal(!1,{container:"wpstg-swal-push-container",confirmButton:s+" wpstg--btn--confirm wpstg-blue-primary wpstg-button wpstg-link-btn"}).fire({title:e,icon:"warning",html:t,width:"750px",focusConfirm:!1,confirmButtonText:n,showCancelButton:!0})},y=function(){var e=[];return u(".wpstg-dir input:checked").each((function(){var t=u(this);t.parent(".wpstg-dir").parents(".wpstg-dir").children(".wpstg-expand-dirs").hasClass("disabled")||e.push(t.val())})),e},S=function(){var e=[];return u(".wpstg-dir input:not(:checked)").each((function(){var t=u(this);e.push(t.val())})),e},k=function(){var e=[];return u("#wpstg_extraDirectories").val()?e=u("#wpstg_extraDirectories").val().split(/\r?\n/):e},x=function(e,t){if(void 0===e.percentage)return!1;var n;if("JobCreateBackup"===e.job&&(d.get("#wpstg-progress-backup").width(.15*e.percentage+"%").html(e.percentage+"%"),d.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 1 of 4 Creating backup...")),("jobFileScanning"===e.job||"jobCopy"===e.job)&&(d.get("#wpstg-progress-backup").css("background-color","#3bc36b"),d.get("#wpstg-progress-backup").html("1. Backup"),d.get("#wpstg-progress-backup").width("15%"),n="jobFileScanning"===e.job?e.percentage/2:50+e.percentage/2,d.get("#wpstg-progress-files").width(.3*n+"%").html(n.toFixed(0)+"%"),d.get("#wpstg-processing-status").html(n.toFixed(0)+"% - Step 2 of 4 Copying files...")),"jobCopyDatabaseTmp"===e.job||"jobSearchReplace"===e.job||"jobData"===e.job){d.get("#wpstg-progress-files").css("background-color","#3bc36b"),d.get("#wpstg-progress-files").html("2. Files"),d.get("#wpstg-progress-files").width("30%");var s=0;s="jobCopyDatabaseTmp"===e.job?e.percentage/3:"jobSearchReplace"===e.job?100/3+e.percentage/3:200/3+e.percentage/3,d.get("#wpstg-progress-data").width(.4*s+"%").html(s.toFixed(0)+"%"),d.get("#wpstg-processing-status").html(s.toFixed(0)+"% - Step 3 of 4 Copying data...")}"jobDatabaseRename"===e.job&&(d.get("#wpstg-progress-data").css("background-color","#3bc36b"),d.get("#wpstg-progress-data").html("3. Data"),d.get("#wpstg-progress-data").width("40%"),d.get("#wpstg-progress-finishing").width(.15*e.percentage+"%").html(e.percentage+"%"),d.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Step 4 of 4 Finishing migration...")),"finished"===e.status&&(d.get("#wpstg-progress-finishing").css("background-color","#3bc36b"),d.get("#wpstg-progress-finishing").html("4. Finishing migration"),d.get("#wpstg-progress-finishing").width("15%"),d.get("#wpstg-processing-status").html(e.percentage.toFixed(0)+"% - Pushing Process Finished"))},(p={isCancelled:!1,isFinished:!1,getLogs:!1,tableSelector:null,fileSelector:null}).init=function(){var e;d.get("#wpstg-workflow").on("click","#wpstg-push-changes",(function(e){e.preventDefault(),d.get(".wpstg-tabs-wrapper").hide(),d.get("#wpstg-push-changes").hide();var t=d.get("#wpstg-push-changes").data("clone-name");v("Confirm Push!","<p class='wpstg-push-confirmation-message'><b>WAIT!</b> This will overwrite the production/live site and its plugins, themes and media assets with data from the staging site: <b>\""+t+"\"</b>.  <br/><br/>Database data will be overwritten for each selected table. Take care if you use a shop system like WooCommerce and check out our FAQ! <br/><br/><b>IMPORTANT:</b> Before you proceed make sure that you have a full site backup. If the pushing process is not successful contact us at <a href='mailto:support@wp-staging.com'>support@wp-staging.com</a> or use the <b>REPORT ISSUE</b> button.</p>","Push","wpstg-confirm-push").then((function(e){if(e.value)return d.get("#wpstg-push-changes").attr("disabled",!0),d.get(".wpstg-prev-step-link").attr("disabled",!0),d.get("#wpstg-scanning-files").hide(),d.get(".wpstg-progress-bar-wrapper").show(),WPStaging.switchStep(3),window.addEventListener("beforeunload",WPStaging.warnIfClosingDuringProcess),void h();d.get(".wpstg-tabs-wrapper").show(),d.get("#wpstg-push-changes").show()}))})),(e=d.get("#wpstg-workflow")).on("click",".wpstg-push-changes",(function(t){if(t.preventDefault(),u(this).attr("disabled"))return!1;e.addClass("loading");var n=u(this).data("clone");p.data={action:"wpstg_scan",clone:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(p.data,(function(t){t.length<1&&showError("Something went wrong! No response.  Go to WP Staging > Settings and lower 'File Copy Limit' and 'DB Query Limit'. Also set 'CPU Load Priority to low 'and try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),e.removeClass("loading").html(t),WPStaging.switchStep(2),d.get(".wpstg-step3-cloning").hide(),d.get(".wpstg-step3-pushing").show(),d.get(".wpstg-loader").hide(),p.tableSelector=new i,p.fileSelector=new c,p.tableSelector.countSelectedTables(),p.fileSelector.countSelectedFiles()}),"HTML")})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-use-target-dir",(function(e){e.preventDefault(),u("#wpstg_clone_dir").val(this.getAttribute("data-path"))})).on("click","#wpstg-use-target-hostname",(function(e){e.preventDefault(),u("#wpstg_clone_hostname").val(this.getAttribute("data-uri"))})).on("change","#wpstg-delete-upload-before-pushing",(function(e){e.currentTarget.checked?u("#wpstg-backup-upload-container").show():(u("#wpstg-backup-upload-container").hide(),u("#wpstg-backup-upload-before-pushing").removeAttr("checked"))})),function(){var e=d.get("#wpstg-workflow");e.on("click","#wpstg-db-connect",(function(e){e.preventDefault(),d.get(".wpstg-loader").show(),d.get("#wpstg-db-status").hide(),WPStaging.ajax({action:"wpstg_database_connect",accessToken:wpstg.accessToken,nonce:wpstg.nonce,databaseUser:d.get("#wpstg_db_username").val(),databasePassword:d.get("#wpstg_db_password").val(),databaseServer:d.get("#wpstg_db_server").val(),databaseDatabase:d.get("#wpstg_db_database").val(),databasePrefix:d.get("#wpstg_db_prefix").val()},(function(e){return!1===e?(showError("Something went wrong! Error: No response.Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),d.get(".wpstg-loader").hide(),d.get("#wpstg-db-status").remove(),d.get("#wpstg-error-details").hide(),void d.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-failed"> Failed</span>')):void 0!==e.errors&&e.errors?(WPStaging.showError("Something went wrong! Error: "+e.errors+" Please try again. If that does not help, <a href='https://wp-staging.com/support/' target='_blank'>open a support ticket</a> "),d.get(".wpstg-loader").hide(),d.get("#wpstg-db-status").hide(),d.get("#wpstg-db-error").remove(),void d.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-failed"> Failed</span><br/><span id="wpstg-db-error" class="wpstg--red">Error: '+e.errors+"</span>")):void(void 0!==e.success&&e.success&&(d.get(".wpstg-loader").hide(),d.get("#wpstg-db-status").hide(),d.get("#wpstg-error-details").hide(),d.get("#wpstg-db-error").hide(),d.get("#wpstg-db-connect").after('<span id="wpstg-db-status" class="wpstg-success"> Success</span>')))}),"json",!1)})),e.on("click","#wpstg-ext-db",(function(){this.checked?(d.get("#wpstg_db_server").removeAttr("readonly"),d.get("#wpstg_db_username").removeAttr("readonly"),d.get("#wpstg_db_password").removeAttr("readonly"),d.get("#wpstg_db_database").removeAttr("readonly"),d.get("#wpstg_db_prefix").removeAttr("readonly")):(d.get("#wpstg_db_server").attr("readonly",!0).val(""),d.get("#wpstg_db_username").attr("readonly",!0).val(""),d.get("#wpstg_db_password").attr("readonly",!0).val(""),d.get("#wpstg_db_database").attr("readonly",!0).val(""),d.get("#wpstg_db_prefix").attr("readonly",!0).val(""))}))}(),function(){var e=d.get("#wpstg-workflow");e.on("click",".wpstg-edit-clone-data",(function(t){if(t.preventDefault(),u(this).attr("disabled"))return!1;var n=u(this).data("clone");p.data={action:"wpstg_edit_clone_data",clone:n,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(p.data,(function(t){e.html(t)}),"HTML")})).on("click",".wpstg-prev-step-link",(function(e){e.preventDefault(),WPStaging.loadOverview()})).on("click","#wpstg-save-clone-data",(function(e){e.preventDefault();var t="#wpstg-edit-clone-data-",n=d.get(t+"clone-id").val(),s=d.get(t+"clone-name").val(),r=d.get(t+"directory-name").val(),o=d.get(t+"path").val(),a=d.get(t+"url").val(),i=d.get(t+"prefix").val(),c=d.get(t+"database-user").val(),l=d.get(t+"database-password").val(),g=d.get(t+"database-database").val(),u=d.get(t+"database-server").val(),h=d.get(t+"database-prefix").val();p.data={action:"wpstg_save_clone_data",clone:n,cloneName:s,directoryName:r,path:o,url:a,prefix:i,externalDBUser:c,externalDBPassword:l,externalDBDatabase:g,externalDBHost:u,externalDBPrefix:h,accessToken:wpstg.accessToken,nonce:wpstg.nonce},WPStaging.ajax(p.data,(function(e){"Success"===e?WPStaging.loadOverview():alert(e)}),"HTML")}))}(),new a,new l},p);jQuery(document).ready((function(e){P.init(),jQuery(document).on("click","#wpstg-update-mail-settings",(function(t){t.preventDefault(),e("#wpstg-update-mail-settings").attr("disabled","disabled");var n={action:"wpstg_update_staging_mail_settings",emailsAllowed:e("#wpstg_allow_emails").is(":checked"),accessToken:wpstg.accessToken,nonce:wpstg.nonce};jQuery.ajax({url:ajaxurl,type:"POST",data:n,error:function(e,t,n){T.getSwalModal().fire("Unknown error","Please get in contact with us to solve it support@wp-staging.com","error")},success:function(t){var n="error";return t.success&&(n="success"),T.getSwalModal().fire("",t.message,n).then((function(){jQuery(".wpstg-mails-notice").slideUp("fast")})),e("#wpstg-update-mail-settings").removeAttr("disabled"),!0},statusCode:{404:function(){T.getSwalModal().fire("404","Something went wrong; can't find ajax request URL! Please get in contact with us to solve it support@wp-staging.com","error")},500:function(){T.getSwalModal().fire("500","Something went wrong; internal server error while processing the request! Please get in contact with us to solve it support@wp-staging.com","error")}}})}))}))}();
//# sourceMappingURL=wpstg-admin-pro.min.js.map
